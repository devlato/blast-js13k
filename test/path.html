<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>blastoff [[test]]</title>
        <link rel="stylesheet" href="../pub/game.css">
    </head>
    <body>
        <div id="container">
            <canvas id="L1" width="900" height="600"></canvas>
            <canvas id="L2" width="900" height="600"></canvas>
        </div>
        <script src="../scripts/util.js"></script>
        <script>
            function ballistic(x1, y1) {
                var dist = Math.sqrt(x1 * x1 + y1 * y1)
                var r = 0.75 * dist
                var a = Math.atan(-x1 / y1) + Math.asin(0.5 * dist / r) + (y1 < 0) * Math.PI
                var x = x1 - r * Math.cos(a)
                var y = y1 - r * Math.sin(a)

                var b0 = Math.atan2(y1 - y, x1 - x)
                var b1 = Math.atan2(-y, -x)

                R2.beginPath()
                R2.arc(x, y, r, b0, b1, true)
                R2.strokeStyle = '#ffdb4c'
                R2.stroke()
            }

            R1.beginPath()
            R1.moveTo(-50, -50)
            R1.lineTo(50, 50)
            R1.moveTo(50, -50)
            R1.lineTo(-50, 50)
            R1.strokeStyle = '#87fc70'
            R1.stroke()

            function mm(event) {
                var bcr = L2.getBoundingClientRect()
                var x = event.clientX - 0.5 * 900 - (0|bcr.left)
                var y = event.clientY - 0.5 * 600 - (0|bcr.top)

                R2.clearRect(-x0, -y0, 900, 600)

                ballistic(x, y)

                R2.beginPath()
                R2.moveTo(-50 + x, y)
                R2.lineTo(50 + x, y)
                R2.moveTo(x, -50 + y)
                R2.lineTo(x, 50 + y)
                R2.strokeStyle = '#fc0'
                R2.stroke()
            }

            L2.addEventListener('mousemove', mm, false)
            L2.style.cursor = 'none'
        </script>
    </body>
</html>
